# 01.04 - Direct Renderer

## Overview

The Direct Renderer is the pure HTML/CSS generation engine that handles ONE theme content and visual building capabilities. It serves as the canvas for user-created content, generating direct DOM elements without React components for the actual content while overlaying React-based visual builder tools for manipulation.

## Architecture

### Core Responsibilities

1. **ONE Theme Rendering**
   - Loads ONE theme independently from UI theme
   - Generates pure HTML/CSS (no React) for content
   - Provides canvas for visual manipulation
   - Handles dynamic element creation

2. **Visual Builder Integration**
   - Overlays interactive tools on content
   - Manages element selection and manipulation
   - Coordinates with visual builder components
   - Maintains separation between content and tools

3. **Event System Hub**
   - Listens for element creation events
   - Dispatches selection/movement events
   - Coordinates between UI controls and canvas
   - Enables cross-component communication

## Current Implementation

### Rendering Pipeline
```
ONE Theme JSON → HTML Generation → Direct DOM Injection → Visual Tools Overlay
```

### Key Features

#### Dynamic Element Management
- Maintains array of user-created elements
- Each element has unique ID and positioning
- Updates in response to user interactions
- Preserves element state during manipulations

#### Event Listeners
```javascript
// Incoming Events
'add-one-element' → Creates new element
'element-moved' → Updates element position
'element-resized' → Updates element dimensions

// Outgoing Events
'element-selected' → Notifies of selection
'element-deselected' → Clears selection
```

#### HTML Generation
- Pure HTML/CSS output (no React in content)
- Inline styles for dynamic positioning
- Data attributes for element identification
- Clean, exportable markup

### Component Structure
```
DirectRenderer (Container)
├── Canvas Content (Pure HTML via dangerouslySetInnerHTML)
├── VisualBuilderControls (React overlay)
├── GridOverlay (React overlay)
└── SelectionHandles (React overlay for selected element)
```

## Key Connections

### With UIGenerator
- Embedded by UIGenerator when `data-label="canvas-content"`
- Receives 'add-one-element' events from UI buttons
- Operates independently with ONE theme
- Maintains clear separation of concerns

### With Theme Processor
```javascript
// Loads ONE theme independently
await runtimeThemeProcessor.applyTheme('one');
const themeConfig = runtimeThemeProcessor.getTheme('one');
```

### With Visual Builder Components
- **GridOverlay**: Provides alignment assistance
- **SelectionHandles**: Enable element manipulation
- **VisualBuilderControls**: Toggle visual aids
- All overlay on top of content, not part of it

## Design Philosophy

### Separation of Concerns
1. **Content Layer** (ONE theme)
   - Pure HTML/CSS
   - No React components
   - Exportable/static
   - Theme-driven styling

2. **Tool Layer** (Visual builders)
   - React components
   - Interactive behaviors
   - Development aids
   - Not part of final output

### Event-Driven Architecture
- Loose coupling via custom events
- No direct component references
- Enables plugin-style extensions
- Clean communication patterns

## Current State

### Working Features
- ✅ ONE theme rendering
- ✅ Dynamic element creation
- ✅ Element selection and manipulation
- ✅ Grid overlay toggling
- ✅ Snap-to-grid functionality
- ✅ Visual builder tool integration

### Limitations
- ❌ Visual builder tools use hardcoded styles
- ❌ No element property editing
- ❌ No copy/paste functionality
- ❌ No undo/redo system
- ❌ Limited element types (wrapper only)

## Element Generation

### Default Structure
```javascript
{
  type: 'wrapper',
  className: '',
  style: {
    position: 'relative',
    width: '100%',
    height: '100%',
    minHeight: '400px'
  }
}
```

### Dynamic Elements
```javascript
{
  id: 'element-[timestamp]',
  type: 'wrapper',
  style: {
    position: 'absolute',
    top: '50px',
    left: '50px',
    zIndex: [index]
  }
}
```

## Performance Considerations

- HTML regeneration on state changes
- Efficient event delegation
- Minimal React re-renders
- Direct DOM manipulation for performance

## Next Steps

### Phase 1: Enhanced Element System
1. **Multiple element types**
   - Text elements
   - Image elements
   - Container variants

2. **Element properties**
   - Background colors
   - Borders and shadows
   - Typography settings

### Phase 2: Advanced Interactions
1. **Multi-select**
   - Group operations
   - Bulk movements
   - Alignment tools

2. **Edit modes**
   - Text editing
   - Image replacement
   - Property panels

### Phase 3: Professional Features
1. **History system**
   - Undo/redo stack
   - State snapshots
   - Version comparison

2. **Export capabilities**
   - Clean HTML export
   - CSS extraction
   - Component generation

## Development Guidelines

### DO:
- Keep content layer pure HTML/CSS
- Use events for all communication
- Maintain tool/content separation
- Preserve exportability of content

### DON'T:
- Mix React into content generation
- Create tight coupling between tools
- Hardcode visual builder styles
- Pollute content with tool artifacts

## Integration Points

### For New Features
1. Add event listener in DirectRenderer
2. Dispatch events for state changes
3. Keep visual tools as overlays
4. Maintain clean HTML output

### For Theme Integration
1. Visual builder presets in ui-theme
2. Content styling from one-theme
3. Clear boundary between themes
4. No style leakage between layers

---

**Note**: DirectRenderer is the bridge between static content (ONE theme) and interactive editing (visual builders). It maintains clean separation while enabling powerful visual manipulation capabilities.
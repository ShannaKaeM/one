# ONEstore

**Current**: 124 lines  
**Purpose**: Central state management - FLAT structure, everything is an asset

---

## FLAT Store Structure (No Nested Actors)

### Current State Values
```typescript
// Selection
selectedAssets: string[]      // IDs of selected assets
activeAsset: string | null    // Currently focused asset

// Clipboard & History
clipboard: Asset | Asset[] | null
history: Action[]

// Canvas Tools
activeTool: string           // From theme, not hardcoded
isDragging: boolean
isResizing: boolean
isRotating: boolean
isGrouping: boolean
isPanning: boolean

// Edit Mode
mode: string                 // From theme, not hardcoded

// View Settings
currentView: string          // From theme layouts, not hardcoded!
zoom: number
grid: boolean
snap: boolean
rulers: boolean

// Panels (Dynamic)
panels: { [key: string]: boolean }  // From theme, not positions!

// Library View
libraryFilter: string        // From theme, not hardcoded!
librarySortBy: string        // From theme
libraryView: string          // From theme
librarySearch: string

// Assets (Everything is an asset)
assets: Asset[]              // Elements, images, presets, ALL OF IT

// PRESET SYSTEM (NEW - REQUIRED)
activePresets: { [assetId: string]: string[] }     // Which presets active per asset
globalPresets: { [assetType: string]: string[] }   // Default presets by type
availablePresets: string[]                          // All presets from theme
presetInheritance: { [assetId: string]: string[] } // Calculated inheritance
```

### Actions
```typescript
// Selection
selectAsset(id: string): void
selectMultiple(ids: string[]): void
clearSelection(): void

// Clipboard
copy(): void
paste(): void
cut(): void
undo(): void
redo(): void

// Tools
setTool(tool: string): void
setMode(mode: string): void

// View
setView(view: string): void
setZoom(zoom: number): void
toggleGrid(): void
toggleSnap(): void
toggleRulers(): void
togglePanel(panelId: string): void

// Library
setLibraryFilter(filter: string): void
setLibrarySort(sort: string): void
setLibraryView(view: string): void
searchLibrary(query: string): void

// Assets
addAsset(asset: Asset): void
updateAsset(id: string, updates: Partial<Asset>): void
deleteAsset(id: string): void
duplicateAsset(id: string): string
groupAssets(ids: string[]): string
ungroupAsset(groupId: string): string[]
moveToLibrary(id: string): void
importAsset(file: File): Promise<Asset>
exportAsset(id: string): Promise<Blob>
saveProject(): Promise<void>
loadProject(data: any): Promise<void>

// PRESET SYSTEM ACTIONS (NEW - REQUIRED)
applyPreset(assetId: string, presetId: string): void
removePreset(assetId: string, presetId: string): void
togglePreset(assetId: string, presetId: string): void
setGlobalPreset(assetType: string, presetId: string): void
clearPresets(assetId: string): void
calculateInheritance(assetId: string): string[]
```

---

## Asset Interface (Everything is an Asset)

```typescript
interface Asset {
  // Identity
  id: string
  type: string              // From theme, not hardcoded!
  name: string
  
  // Location & Storage
  location: string          // From theme, not hardcoded!
  url?: string
  
  // Relationships
  parent?: string
  children?: string[]
  usedBy?: string[]
  uses?: string[]
  
  // Properties
  content?: any
  style?: object
  transform?: object
  
  // State
  visible: boolean
  locked: boolean
  zIndex: number
  
  // PRESET FIELDS (NEW)
  presets: string[]         // Active presets on this asset
  inheritedPresets?: string[] // Calculated from parent
  
  // Metadata
  created: Date
  modified: Date
  version: number
  size?: number
  dimensions?: { width: number, height: number }
  tags: string[]
  collections: string[]
}
```

---

## Key Changes Made

### 1. **Removed ALL Hardcoded Values**
- ❌ No more 'dashboard | canvas | library'
- ❌ No more 'select | move | text'  
- ❌ No more 'left | right | bottom' panels
- ✅ Everything comes from theme

### 2. **Flat Structure**
- ❌ No more nested actors (designer.selection.assets)
- ✅ Direct access (selectedAssets)
- ✅ Simpler, faster, cleaner

### 3. **Added Preset System**
As decided in 03.01-PRESET-SYSTEM.md:
- Active presets tracking per asset
- Global presets by type
- Inheritance calculation
- All preset actions

### 4. **Everything is an Asset**
- Elements, images, presets, styles - all in one array
- Unified operations for all types
- Relationships between assets

---

## Integration with Other Systems

### PresetManager (from 03.01-PRESET-SYSTEM.md)
- Store tracks WHAT presets are active
- PresetManager handles HOW they're applied
- Store provides state, Manager provides runtime updates

### ONEconnect
- Reads currentView for layout
- Reads activePresets for styling
- Reads panels for UI configuration

### Theme Processor
- Provides available layouts, tools, asset types
- No hardcoded values in store!

---

## Benefits of This Structure

1. **No Hardcoding** - Everything theme-driven
2. **Flat Access** - No nested paths to remember
3. **Unified Assets** - One system for everything
4. **Preset Ready** - Full preset system included
5. **Future Proof** - Can add any asset type

---

*Single source of truth for ALL state - flat, fast, flexible*
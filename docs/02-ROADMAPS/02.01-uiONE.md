# uiONE Virtual Component System

**Purpose**: Test three approaches for creating theme-driven virtual components

---

## Current System Status

### ‚úÖ What We Have Working

1. **ONEconnect Auto-registration**
   - Falls back to 'div' when component not found
   - Creates divs with all data attributes preserved
   - Perfect foundation for virtual components!

2. **Basic Store Connection**
   - Simple data binding works (one level)
   - Action binding works
   - Store structure ready

3. **Theme to CSS**
   - Variables work
   - Basic structure styling
   - Theme scoping (.ui, .one)

4. **ONE Component**
   - 116 lines combining base element + loop
   - More advanced than OOPS versions
   - Already has data iteration

### ‚ùå Critical Missing Features

1. **PRESET SYSTEM** (Most Critical) - **DECISION MADE: Full 4-component system**
   - Theme Processor - Generate CSS from presets
   - PresetStore - Track active presets
   - PresetManager - Runtime CSS variable updates (KEY!)
   - ONEconnect - Apply classes and targets

2. **Advanced Store Features**
   - No deep path support (designer.selectedElement)
   - No multiple data sources per component
   - Missing presetStore for styling

3. **Layout Switching**
   - ONEconnect reads from hardcoded theme.root.layouts
   - Needs to read from store for dynamic switching
   - No connection to currentView in store

4. **Component Features**
   - No recursive component loading
   - No data transformation
   - No preset targeting

---

## Features Needed Before Testing

### 1. Preset System in Theme Processor
**Where**: Theme Processor
**What**: Add preset processing to generate CSS like:
```css
.ui.primary { background: red; }
.ui .sidebar-wrapper { width: 250px; }
```
**Why**: Without this, virtual divs can't be styled

### 2. PresetStore Implementation
**Where**: New store (evaluate from OOPS)
**What**: 
- Track which presets apply to which elements
- Handle preset inheritance
- Connect to ONEconnect
**Why**: Manages preset application logic

### 3. Flexible Layout Reading
**Where**: ONEconnect
**What**: Change from `theme.structure.root.layouts` to store-based
**Why**: Enable dynamic layout switching

### 4. Deep Path Store Support
**Where**: StoreConnector
**What**: Support paths like "oneStore.designer.selectedElement"
**Why**: Proper store structure access

---

## Three Testing Approaches

### Option A: Pre-register uiONE
```typescript
// In App.tsx
const components = {
  uiONE: UIOneElement  // Register once
};

// In theme
"sidebar": {
  "data-component": "uiONE",
  "presets": "sidebar primary"
}
```
**Pros**: Traditional React approach
**Cons**: Need to handle preset application in component

### Option B: Auto-registration with uiONE name
```typescript
// App.tsx - empty components
const components = {};

// In theme - ONEconnect creates div
"sidebar": {
  "data-component": "uiONE",  // Becomes <div>
  "presets": "sidebar primary"
}
```
**Pros**: No React component needed
**Cons**: Pure div, all styling via presets

### Option C: Pure theme-driven
```typescript
// No registration at all

// In theme - any name works
"my-sidebar": {
  "data-component": "anything",  // Still becomes <div>
  "presets": "sidebar primary"
}
```
**Pros**: Maximum flexibility
**Cons**: No type safety

---

## Implementation Order

### Phase 1: Foundation (Required for all approaches)
1. [ ] Add preset system to Theme Processor (CSS generation)
2. [ ] Implement PresetStore (state tracking)
3. [ ] Implement PresetManager (runtime application) - CRITICAL!
4. [ ] Enhance ONEconnect for preset targeting
5. [ ] Connect ONEconnect to read layouts from store
6. [ ] Add deep path support to StoreConnector

### Phase 2: Test Each Approach
1. [ ] Create test theme with virtual components
2. [ ] Test Option A (pre-registered)
3. [ ] Test Option B (auto-div with uiONE)
4. [ ] Test Option C (pure theme)
5. [ ] Compare results

### Phase 3: Enhance Winner
1. [ ] Add recursive component loading
2. [ ] Add data transformation
3. [ ] Add state-based styling
4. [ ] Complete preset inheritance

---

## Store Features for uiONE System

### ‚úÖ DECIDED - Will Implement:

1. **presetStore** (210 lines) - **IMPLEMENTING WITH PRESETMANAGER**
   - Track which presets each element uses
   - Store available presets from theme
   - Handle preset inheritance
   - Part of our 4-component preset system

### üîÑ NEED TO EVALUATE - For Virtual Components:

2. **Element Management Features** (from elementStore - 425 lines)
   - **Visibility** - Show/hide elements (need for layers)
   - **Locking** - Prevent editing locked elements
   - **Z-index** - Layer order management (front/back)
   - **Grouping** - Group/ungroup elements
   - **WHERE**: Add to Projects actor? New actor?

3. **Deep Path Support** (StoreConnector issue)
   - Current: Can only read "oneStore.selectedElement"
   - Need: Read nested paths like "oneStore.designer.selectedElement"
   - **WHERE**: Fix in StoreConnector, not store

### ‚ùì MAYBE LATER - Not Critical for Virtual Components:

4. **Save/Load** (from projectStore - 467 lines)
   - Save projects to localStorage
   - Auto-save functionality
   - Import/export
   - **WHEN**: After virtual components work

5. **Library Management** (174 lines)
   - R2 integration
   - Asset management
   - **WHEN**: When we need external assets

---

## Success Criteria

A virtual component system that:
1. Creates UI elements purely from theme JSON
2. Applies styling via presets
3. Connects to store data/actions
4. Supports dynamic updates
5. No hardcoded components needed

---

## Next Steps

1. Review this roadmap - anything missing?
2. Implement Phase 1 foundation features
3. Create test themes for each approach
4. Run tests and document findings

---

*Virtual components = Theme-driven UI without React components*